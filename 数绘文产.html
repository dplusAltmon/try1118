<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数绘文产·2024 - 文化产业发展数据可视化</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --morandi-green: #9CAF88;
            --morandi-blue: #6E7B8B;
            --morandi-pink: #D4A5A5;
            --morandi-beige: #F0E6D4;
            --morandi-clay: #BF9A77;
            --morandi-dark: #4A4A4A;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: var(--morandi-beige);
            color: var(--morandi-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .dashboard-header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }
        
        .dashboard-title {
            font-size: 3.5rem;
            font-weight: 300;
            color: var(--morandi-dark);
            margin-bottom: 10px;
            letter-spacing: 4px;
        }
        
        .dashboard-subtitle {
            font-size: 1.2rem;
            color: var(--morandi-blue);
            max-width: 700px;
            margin: 0 auto;
            font-weight: 300;
        }
        
        .title-decoration {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--morandi-green), transparent);
        }
        
        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(4, 450px);
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .viz-container {
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(158, 175, 136, 0.2);
        }
        
        .viz-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.08);
        }
        
        .viz-title {
            font-size: 1.2rem;
            color: var(--morandi-dark);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--morandi-green);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .viz-subtitle {
            font-size: 0.9rem;
            color: var(--morandi-blue);
            font-weight: 300;
            margin-bottom: 5px;
        }
        
        .chart-container {
            width: 100%;
            height: calc(100% - 50px);
            position: relative;
        }
        
        .legend {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.85);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            display: flex;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .dashboard-footer {
            text-align: center;
            padding: 30px 0;
            border-top: 1px solid rgba(158, 175, 136, 0.3);
            color: var(--morandi-blue);
            font-size: 0.9rem;
            line-height: 1.8;
        }
        
        .data-source {
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .signature {
            font-weight: 500;
            letter-spacing: 1px;
        }
        
        /* 3D容器样式 */
        #regional-matrix-container {
            width: 100%;
            height: 100%;
        }
        
        /* 响应式布局 */
        @media (max-width: 1200px) {
            .visualization-grid {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(8, 400px);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-title {
                font-size: 2.5rem;
            }
            
            .visualization-grid {
                grid-template-rows: repeat(8, 350px);
            }
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .viz-container {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        .viz-container:nth-child(1) { animation-delay: 0.1s; }
        .viz-container:nth-child(2) { animation-delay: 0.2s; }
        .viz-container:nth-child(3) { animation-delay: 0.3s; }
        .viz-container:nth-child(4) { animation-delay: 0.4s; }
        .viz-container:nth-child(5) { animation-delay: 0.5s; }
        .viz-container:nth-child(6) { animation-delay: 0.6s; }
        .viz-container:nth-child(7) { animation-delay: 0.7s; }
        .viz-container:nth-child(8) { animation-delay: 0.8s; }
        
        /* 装饰元素 */
        .decoration {
            position: absolute;
            z-index: -1;
            opacity: 0.1;
        }
        
        .circle {
            border-radius: 50%;
            border: 1px solid var(--morandi-green);
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="dashboard-header">
            <div class="title-decoration"></div>
            <h1 class="dashboard-title">数绘文产·2024</h1>
            <p class="dashboard-subtitle">基于国家统计局数据的文化及相关产业发展可视化分析报告</p>
        </div>
        
        <div class="visualization-grid">
            <!-- 1. 营收趋势环流图 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>文化产业发展趋势 (2019-2024)</span>
                    <span class="viz-subtitle">营收与资产增长分析</span>
                </div>
                <div class="chart-container" id="revenue-trend"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-green);"></div>
                        <span>营收 (亿元)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-blue);"></div>
                        <span>资产 (亿元)</span>
                    </div>
                </div>
            </div>
            
            <!-- 2. 产业结构三维嵌套环 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>文化产业三层结构分析</span>
                    <span class="viz-subtitle">服务业/制造业/批发零售业占比</span>
                </div>
                <div class="chart-container" id="industry-structure"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-pink);"></div>
                        <span>文化服务业</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-green);"></div>
                        <span>文化制造业</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-clay);"></div>
                        <span>批发零售业</span>
                    </div>
                </div>
            </div>
            
            <!-- 3. 区域发展立体矩阵 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>区域文化产业发展对比</span>
                    <span class="viz-subtitle">东部/中部/西部/东北地区营收与增速</span>
                </div>
                <div class="chart-container" id="regional-matrix-container"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-clay);"></div>
                        <span>东部地区</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-pink);"></div>
                        <span>中部地区</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-green);"></div>
                        <span>西部地区</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-blue);"></div>
                        <span>东北地区</span>
                    </div>
                </div>
            </div>
            
            <!-- 4. 新业态动态桑基图 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>文化新业态动态流向</span>
                    <span class="viz-subtitle">16个新业态行业营收贡献分析</span>
                </div>
                <div class="chart-container" id="new-industry-flow"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-blue);"></div>
                        <span>高增长新业态 (>10%)</span>
                    </div>
                </div>
            </div>
            
            <!-- 5. 行业利润热力棋盘 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>行业利润热力分布图</span>
                    <span class="viz-subtitle">九大行业利润率对比分析</span>
                </div>
                <div class="chart-container" id="profit-heatmap"></div>
                <div class="legend">
                    <div class="legend-item">
                        <span>← 低利润率</span>
                        <div style="display:inline-block; width:80px; height:12px; background: linear-gradient(90deg, var(--morandi-beige), var(--morandi-dark)); border-radius:2px;"></div>
                        <span>高利润率 →</span>
                    </div>
                </div>
            </div>
            
            <!-- 6. 效能指标散点星云 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>文化行业效能分析</span>
                    <span class="viz-subtitle">人均营收 vs 利润率</span>
                </div>
                <div class="chart-container" id="efficiency-bubble"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-pink);"></div>
                        <span>高效能区</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-green);"></div>
                        <span>中效能区</span>
                    </div>
                </div>
            </div>
            
            <!-- 7. 文化消费零售时钟 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>文化消费零售趋势</span>
                    <span class="viz-subtitle">2024上半年文化用品零售分析</span>
                </div>
                <div class="chart-container" id="retail-clock"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-clay);"></div>
                        <span>文化用品零售额</span>
                    </div>
                </div>
            </div>
            
            <!-- 8. 文化经济贡献联动图 -->
            <div class="viz-container">
                <div class="viz-title">
                    <span>文化产业经济贡献分析</span>
                    <span class="viz-subtitle">占GDP比重 vs 第三产业增速</span>
                </div>
                <div class="chart-container" id="gdp-contribution"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-green);"></div>
                        <span>文化产业增速</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--morandi-blue);"></div>
                        <span>第三产业增速</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-footer">
            <p class="data-source">数据来源：国家统计局《2024年全国文化及相关产业发展情况报告》(https://www.stats.gov.cn/sj/zxfb/202506/t20250627_1960269.html)，国家统计局2025上半年GDP核算数据</p>
            <p class="signature">22计传张颖惠 202201083025 ｜ 22计传刘竹 202201083018</p>
            <p>© 2025 数绘文产数据可视化项目</p>
        </div>
    </div>

    <script>
        // 莫兰迪配色方案
        const colors = {
            green: "#9CAF88",
            blue: "#6E7B8B",
            pink: "#D4A5A5",
            beige: "#F0E6D4",
            clay: "#BF9A77",
            dark: "#4A4A4A"
        };
        
        // 模拟数据 - 实际应用中应从国家统计局API获取
        const cultureData = {
            // 总体规模
            overall: {
                revenue: 191423, // 亿元
                revenueGrowth: 7.1, // %
                assets: 343987, // 亿元
                assetsGrowth: 5.0 // %
            },
            
            // 产业结构
            industryStructure: {
                services: { value: 57.0, revenue: 109134 },
                manufacturing: { value: 28.5, revenue: 54555 },
                wholesale: { value: 14.5, revenue: 27734 }
            },
            
            // 新业态
            newIndustries: {
                revenue: 66600,
                growth: 12.4,
                contribution: 57.9
            },
            
            // 区域发展
            regions: {
                east: { revenue: 141750, growth: 7.8 },
                central: { revenue: 23111, growth: 6.5 },
                west: { revenue: 18462, growth: 2.6 },
                northeast: { revenue: 10100, growth: 3.2 }
            },
            
            // 利润与效能
            profits: {
                total: 17737, // 亿元
                growth: 7.9, // %
                perCapita: 8.1 // 万元
            },
            
            // 行业利润率
            industryProfits: [
                { name: "数字内容", profit: 15.8 },
                { name: "创意设计", profit: 14.2 },
                { name: "内容创作", profit: 12.6 },
                { name: "文化传播", profit: 9.4 },
                { name: "文化投资", profit: 8.7 },
                { name: "文化装备", profit: 7.5 },
                { name: "文化终端", profit: 6.8 },
                { name: "文化休闲", profit: 5.3 },
                { name: "文化传播渠道", profit: 4.5 }
            ],
            
            // 效能指标
            efficiency: [
                { name: "数字出版", revenuePerCapita: 12.5, profitRate: 18.2, size: 24 },
                { name: "互联网广告", revenuePerCapita: 15.2, profitRate: 16.8, size: 32 },
                { name: "娱乐用无人机", revenuePerCapita: 8.7, profitRate: 14.5, size: 18 },
                { name: "数字艺术", revenuePerCapita: 9.8, profitRate: 12.6, size: 16 },
                { name: "文化会展", revenuePerCapita: 7.2, profitRate: 8.4, size: 12 },
                { name: "出版发行", revenuePerCapita: 6.8, profitRate: 7.2, size: 20 },
                { name: "演艺娱乐", revenuePerCapita: 5.5, profitRate: 6.8, size: 14 },
                { name: "广播影视", revenuePerCapita: 6.2, profitRate: 5.9, size: 18 },
                { name: "文化用品制造", revenuePerCapita: 5.1, profitRate: 4.8, size: 22 }
            ],
            
            // 文化消费
            culturalConsumption: {
                share: 24.9, // 占社零总额的%
                growth: 8.5 // 增速%
            },
            
            // GDP贡献
            gdpContribution: {
                share: 4.2, // 占GDP比重%
                growth: 7.1, // 增速%
                tertiaryGrowth: 6.3 // 第三产业增速%
            },
            
            // 历史趋势
            trends: [
                { year: 2019, revenue: 145000, assets: 265000 },
                { year: 2020, revenue: 132000, assets: 275000 },
                { year: 2021, revenue: 152000, assets: 295000 },
                { year: 2022, revenue: 165000, assets: 310000 },
                { year: 2023, revenue: 178500, assets: 327000 },
                { year: 2024, revenue: 191423, assets: 343987 }
            ]
        };
        
        // 1. 营收趋势环流图
        function createRevenueTrend() {
            const container = d3.select("#revenue-trend");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const margin = { top: 20, right: 20, bottom: 40, left: 50 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
            // X轴比例尺 (年份)
            const xScale = d3.scaleLinear()
                .domain([2019, 2024])
                .range([0, innerWidth]);
            
            // Y轴比例尺 (营收和资产)
            const yScale = d3.scaleLinear()
                .domain([0, 400000])
                .range([innerHeight, 0]);
            
            // 生成营收曲线
            const revenueLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => yScale(d.revenue))
                .curve(d3.curveMonotoneX);
            
            // 生成资产曲线
            const assetsLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => yScale(d.assets))
                .curve(d3.curveMonotoneX);
            
            // 添加营收曲线
            g.append("path")
                .datum(cultureData.trends)
                .attr("fill", "none")
                .attr("stroke", colors.green)
                .attr("stroke-width", 3)
                .attr("d", revenueLine);
            
            // 添加资产曲线
            g.append("path")
                .datum(cultureData.trends)
                .attr("fill", "none")
                .attr("stroke", colors.blue)
                .attr("stroke-width", 3)
                .attr("d", assetsLine);
            
            // 添加数据点
            g.selectAll(".revenue-point")
                .data(cultureData.trends)
                .enter().append("circle")
                .attr("cx", d => xScale(d.year))
                .attr("cy", d => yScale(d.revenue))
                .attr("r", 5)
                .attr("fill", colors.green)
                .attr("stroke", "white")
                .attr("stroke-width", 2);
            
            g.selectAll(".asset-point")
                .data(cultureData.trends)
                .enter().append("circle")
                .attr("cx", d => xScale(d.year))
                .attr("cy", d => yScale(d.assets))
                .attr("r", 5)
                .attr("fill", colors.blue)
                .attr("stroke", "white")
                .attr("stroke-width", 2);
            
            // 添加X轴
            g.append("g")
                .attr("transform", `translate(0, ${innerHeight})`)
                .call(d3.axisBottom(xScale).tickFormat(d3.format("d")).ticks(5))
                .attr("color", colors.dark);
            
            // 添加Y轴
            g.append("g")
                .call(d3.axisLeft(yScale).tickFormat(d => `${d/10000}万`).ticks(5))
                .attr("color", colors.dark);
            
            // 添加标题
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", -5)
                .attr("text-anchor", "middle")
                .text("文化产业营收与资产增长趋势 (2019-2024)")
                .attr("fill", colors.dark)
                .attr("font-size", "14px");
            
            // 添加2024年数据标签
            g.append("text")
                .attr("x", xScale(2024) + 10)
                .attr("y", yScale(cultureData.trends[5].revenue) - 10)
                .text(`营收: ${(cultureData.overall.revenue/10000).toFixed(1)}万亿元 (+${cultureData.overall.revenueGrowth}%)`)
                .attr("fill", colors.green)
                .attr("font-size", "12px");
            
            g.append("text")
                .attr("x", xScale(2024) + 10)
                .attr("y", yScale(cultureData.trends[5].assets) + 20)
                .text(`资产: ${(cultureData.overall.assets/10000).toFixed(1)}万亿元 (+${cultureData.overall.assetsGrowth}%)`)
                .attr("fill", colors.blue)
                .attr("font-size", "12px");
        }
        
        // 2. 产业结构三维嵌套环
        function createIndustryStructure() {
            const container = d3.select("#industry-structure");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const radius = Math.min(width, height) / 2 - 20;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 创建饼图布局
            const pie = d3.pie()
                .value(d => d.value)
                .sort(null);
            
            const data = [
                {name: "文化服务业", value: 57.0, color: colors.pink},
                {name: "文化制造业", value: 28.5, color: colors.green},
                {name: "批发零售业", value: 14.5, color: colors.clay}
            ];
            
            const arc = d3.arc()
                .innerRadius(radius * 0.5)
                .outerRadius(radius);
            
            const arcs = pie(data);
            
            // 绘制扇形
            svg.selectAll("path")
                .data(arcs)
                .enter()
                .append("path")
                .attr("d", arc)
                .attr("fill", d => d.data.color)
                .attr("stroke", "white")
                .attr("stroke-width", 2)
                .attr("transform", `translate(${centerX}, ${centerY})`);
            
            // 添加标签
            const labelArc = d3.arc()
                .innerRadius(radius * 0.75)
                .outerRadius(radius * 0.75);
            
            svg.selectAll("text")
                .data(arcs)
                .enter()
                .append("text")
                .attr("transform", d => `translate(${labelArc.centroid(d).map((v, i) => v + [centerX, centerY][i])})`)
                .attr("text-anchor", "middle")
                .text(d => `${d.data.name}: ${d.data.value}%`)
                .attr("fill", colors.dark)
                .attr("font-size", "12px")
                .attr("font-weight", "500");
            
            // 添加内环
            const innerCircle = svg.append("circle")
                .attr("cx", centerX)
                .attr("cy", centerY)
                .attr("r", radius * 0.3)
                .attr("fill", colors.beige)
                .attr("stroke", colors.dark)
                .attr("stroke-width", 1)
                .attr("opacity", 0.8);
            
            // 内环文字
            svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY - 10)
                .attr("text-anchor", "middle")
                .text("产业结构")
                .attr("fill", colors.dark)
                .attr("font-weight", "bold");
            
            svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY + 15)
                .attr("text-anchor", "middle")
                .text("2024年")
                .attr("fill", colors.dark);
        }
        
        // 3. 区域发展立体矩阵 (使用Three.js)
        function createRegionalMatrix() {
            const container = document.getElementById('regional-matrix-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            // 创建场景
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0e6d4);
            
            // 创建相机
            const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            camera.position.z = 15;
            camera.position.y = 8;
            camera.position.x = 5;
            
            // 创建渲染器
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(width, height);
            container.appendChild(renderer.domElement);
            
            // 添加轨道控制器
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // 添加灯光
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 15);
            scene.add(directionalLight);
            
            // 区域数据
            const regions = [
                { name: "东部", value: 141750, color: colors.clay, position: [-2, 0, 0] },
                { name: "中部", value: 23111, color: colors.pink, position: [-2, 0, 3] },
                { name: "西部", value: 18462, color: colors.green, position: [3, 0, 0] },
                { name: "东北", value: 10100, color: colors.blue, position: [3, 0, 3] }
            ];
            
            // 创建柱状图
            regions.forEach(region => {
                const height = region.value / 8000; // 缩放比例
                const radius = 0.5;
                
                const geometry = new THREE.CylinderGeometry(radius, radius, height, 32);
                const material = new THREE.MeshPhongMaterial({ 
                    color: region.color,
                    shininess: 30
                });
                
                const cylinder = new THREE.Mesh(geometry, material);
                cylinder.position.set(region.position[0], height/2, region.position[2]);
                scene.add(cylinder);
                
                // 添加文字标签
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 128;
                context.fillStyle = region.color;
                context.font = 'bold 48px Arial';
                context.textAlign = 'center';
                context.fillText(`${(region.value/10000).toFixed(1)}万亿`, 128, 64);
                
                const texture = new THREE.CanvasTexture(canvas);
                const labelMaterial = new THREE.MeshBasicMaterial({ 
                    map: texture,
                    transparent: true,
                    side: THREE.DoubleSide
                });
                
                const labelGeometry = new THREE.PlaneGeometry(2, 1);
                const label = new THREE.Mesh(labelGeometry, labelMaterial);
                label.position.set(region.position[0], height + 1, region.position[2]);
                scene.add(label);
            });
            
            // 添加网格平面
            const gridHelper = new THREE.GridHelper(10, 10, 0x444444, 0x444444);
            scene.add(gridHelper);
            
            // 添加标题
            const titleCanvas = document.createElement('canvas');
            const titleContext = titleCanvas.getContext('2d');
            titleCanvas.width = 512;
            titleCanvas.height = 128;
            titleContext.fillStyle = colors.dark;
            titleContext.font = 'bold 36px Arial';
            titleContext.textAlign = 'center';
            titleContext.fillText('区域文化产业发展对比 (2024年)', 256, 64);
            
            const titleTexture = new THREE.CanvasTexture(titleCanvas);
            const titleMaterial = new THREE.MeshBasicMaterial({ 
                map: titleTexture,
                transparent: true
            });
            
            const titleGeometry = new THREE.PlaneGeometry(8, 2);
            const title = new THREE.Mesh(titleGeometry, titleMaterial);
            title.position.set(0, 8, -5);
            scene.add(title);
            
            // 动画循环
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            
            animate();
            
            // 响应窗口大小变化
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }
        
        // 4. 新业态动态桑基图
        function createNewIndustryFlow() {
            const container = d3.select("#new-industry-flow");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // 模拟新业态数据
            const industries = [
                { name: "数字出版", value: 18500, growth: 15.2 },
                { name: "互联网广告", value: 15200, growth: 14.8 },
                { name: "娱乐用无人机", value: 8200, growth: 13.5 },
                { name: "数字艺术", value: 7800, growth: 12.8 },
                { name: "可穿戴设备", value: 6500, growth: 11.9 },
                { name: "虚拟现实", value: 5800, growth: 10.7 }
            ];
            
            const margin = { top: 20, right: 20, bottom: 30, left: 40 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
            // 创建比例尺
            const xScale = d3.scaleBand()
                .domain(industries.map(d => d.name))
                .range([0, innerWidth])
                .padding(0.1);
            
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(industries, d => d.value)])
                .range([innerHeight, 0]);
            
            // 添加柱状图
            g.selectAll("rect")
                .data(industries)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d.name))
                .attr("y", d => yScale(d.value))
                .attr("width", xScale.bandwidth())
                .attr("height", d => innerHeight - yScale(d.value))
                .attr("fill", d => d.growth > 12 ? colors.blue : d3.color(colors.blue).brighter(1))
                .attr("rx", 4)
                .attr("ry", 4);
            
            // 添加增长曲线
            const line = d3.line()
                .x(d => xScale(d.name) + xScale.bandwidth() / 2)
                .y(d => yScale(d.value) - 15)
                .curve(d3.curveCatmullRom);
            
            g.append("path")
                .datum(industries)
                .attr("d", line)
                .attr("fill", "none")
                .attr("stroke", colors.dark)
                .attr("stroke-width", 2)
                .attr("stroke-dasharray", "5,5");
            
            // 添加增长值标签
            g.selectAll(".growth-label")
                .data(industries)
                .enter()
                .append("text")
                .attr("x", d => xScale(d.name) + xScale.bandwidth() / 2)
                .attr("y", d => yScale(d.value) - 20)
                .attr("text-anchor", "middle")
                .text(d => `+${d.growth}%`)
                .attr("fill", colors.dark)
                .attr("font-size", "12px")
                .attr("font-weight", "bold");
            
            // 添加柱状图标签
            g.selectAll(".bar-label")
                .data(industries)
                .enter()
                .append("text")
                .attr("x", d => xScale(d.name) + xScale.bandwidth() / 2)
                .attr("y", d => yScale(d.value) - 35)
                .attr("text-anchor", "middle")
                .text(d => `${(d.value/10000).toFixed(1)}万亿`)
                .attr("fill", "white")
                .attr("font-size", "11px")
                .attr("font-weight", "bold");
            
            // 添加标题
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", -5)
                .attr("text-anchor", "middle")
                .text("文化新业态营收规模与增长率")
                .attr("fill", colors.dark)
                .attr("font-size", "14px");
            
            // 添加注释
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", innerHeight + 25)
                .attr("text-anchor", "middle")
                .text("新业态对文化产业增长贡献率达57.9%")
                .attr("fill", colors.blue)
                .attr("font-size", "12px")
                .attr("font-weight", "bold");
        }
        
        // 5. 行业利润热力棋盘
        function createProfitHeatmap() {
            const container = d3.select("#profit-heatmap");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const margin = { top: 40, right: 20, bottom: 60, left: 60 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
            // 创建颜色比例尺
            const colorScale = d3.scaleSequential()
                .domain([0, d3.max(cultureData.industryProfits, d => d.profit)])
                .interpolator(d3.interpolate(colors.beige, colors.dark));
            
            // 创建坐标比例尺
            const xScale = d3.scaleBand()
                .domain(cultureData.industryProfits.map(d => d.name))
                .range([0, innerWidth])
                .padding(0.1);
            
            const yScale = d3.scaleBand()
                .domain(cultureData.industryProfits.map((d, i) => i))
                .range([0, innerHeight])
                .padding(0.1);
            
            // 添加单元格
            g.selectAll("rect")
                .data(cultureData.industryProfits)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d.name))
                .attr("y", (d, i) => yScale(i))
                .attr("width", xScale.bandwidth())
                .attr("height", yScale.bandwidth())
                .attr("fill", d => colorScale(d.profit))
                .attr("rx", 4)
                .attr("ry", 4);
            
            // 添加利润值文本
            g.selectAll("text")
                .data(cultureData.industryProfits)
                .enter()
                .append("text")
                .attr("x", d => xScale(d.name) + xScale.bandwidth() / 2)
                .attr("y", (d, i) => yScale(i) + yScale.bandwidth() / 2)
                .attr("text-anchor", "middle")
                .attr("dy", "0.35em")
                .text(d => `${d.profit}%`)
                .attr("fill", d => d.profit > 10 ? "white" : colors.dark)
                .attr("font-size", "12px")
                .attr("font-weight", d => d.profit > 10 ? "bold" : "normal");
            
            // 添加X轴
            g.append("g")
                .attr("transform", `translate(0, ${innerHeight})`)
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .attr("transform", "rotate(-30)")
                .attr("text-anchor", "end")
                .attr("dx", "-0.8em")
                .attr("dy", "0.15em")
                .attr("font-size", "10px");
            
            // 添加Y轴
            g.append("g")
                .call(d3.axisLeft(yScale).tickFormat((d, i) => cultureData.industryProfits[i].name))
                .attr("font-size", "10px");
            
            // 添加标题
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .text("文化产业各细分行业利润率分布")
                .attr("fill", colors.dark)
                .attr("font-size", "14px");
            
            // 添加注释
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", innerHeight + 40)
                .attr("text-anchor", "middle")
                .text("数字内容服务利润率最高 (15.8%)，文化传播渠道最低 (4.5%)")
                .attr("fill", colors.blue)
                .attr("font-size", "12px");
        }
        
        // 6. 效能指标散点星云
        function createEfficiencyBubble() {
            const container = d3.select("#efficiency-bubble");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const margin = { top: 30, right: 30, bottom: 60, left: 60 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
            // 创建比例尺
            const xScale = d3.scaleLinear()
                .domain([0, d3.max(cultureData.efficiency, d => d.revenuePerCapita) * 1.1])
                .range([0, innerWidth]);
            
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(cultureData.efficiency, d => d.profitRate) * 1.1])
                .range([innerHeight, 0]);
            
            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(cultureData.efficiency, d => d.size)])
                .range([5, 30]);
            
            // 添加气泡
            g.selectAll("circle")
                .data(cultureData.efficiency)
                .enter()
                .append("circle")
                .attr("cx", d => xScale(d.revenuePerCapita))
                .attr("cy", d => yScale(d.profitRate))
                .attr("r", d => sizeScale(d.size))
                .attr("fill", d => d.profitRate > 12 ? colors.pink : colors.green)
                .attr("opacity", 0.7)
                .attr("stroke", "white")
                .attr("stroke-width", 1);
            
            // 添加标签
            g.selectAll("text")
                .data(cultureData.efficiency)
                .enter()
                .append("text")
                .attr("x", d => xScale(d.revenuePerCapita))
                .attr("y", d => yScale(d.profitRate) - sizeScale(d.size) - 5)
                .attr("text-anchor", "middle")
                .text(d => d.name)
                .attr("fill", colors.dark)
                .attr("font-size", "10px");
            
            // 添加X轴
            g.append("g")
                .attr("transform", `translate(0, ${innerHeight})`)
                .call(d3.axisBottom(xScale))
                .append("text")
                .attr("x", innerWidth / 2)
                .attr("y", 35)
                .attr("text-anchor", "middle")
                .text("人均营收 (万元)")
                .attr("fill", colors.dark);
            
            // 添加Y轴
            g.append("g")
                .call(d3.axisLeft(yScale))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -40)
                .attr("x", -innerHeight/2)
                .attr("text-anchor", "middle")
                .text("利润率 (%)")
                .attr("fill", colors.dark);
            
            // 添加标题
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .text("文化产业效能分析：人均营收 vs 利润率")
                .attr("fill", colors.dark)
                .attr("font-size", "14px");
            
            // 添加象限线
            const medianRevenue = d3.median(cultureData.efficiency, d => d.revenuePerCapita);
            const medianProfit = d3.median(cultureData.efficiency, d => d.profitRate);
            
            g.append("line")
                .attr("x1", xScale(medianRevenue))
                .attr("y1", 0)
                .attr("x2", xScale(medianRevenue))
                .attr("y2", innerHeight)
                .attr("stroke", colors.dark)
                .attr("stroke-width", 0.5)
                .attr("stroke-dasharray", "4,2");
            
            g.append("line")
                .attr("x1", 0)
                .attr("y1", yScale(medianProfit))
                .attr("x2", innerWidth)
                .attr("y2", yScale(medianProfit))
                .attr("stroke", colors.dark)
                .attr("stroke-width", 0.5)
                .attr("stroke-dasharray", "4,2");
            
            // 添加象限标签
            g.append("text")
                .attr("x", xScale(medianRevenue/2))
                .attr("y", yScale(medianProfit*1.8))
                .attr("text-anchor", "middle")
                .text("高效能区")
                .attr("fill", colors.pink)
                .attr("font-weight", "bold");
        }
        
        // 7. 文化消费零售时钟
        function createRetailClock() {
            const container = d3.select("#retail-clock");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const radius = Math.min(width, height) / 2 - 30;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 创建饼图数据 (模拟2024上半年各月数据)
            const months = [
                { month: "1月", value: 12.5, event: "春节" },
                { month: "2月", value: 10.2 },
                { month: "3月", value: 9.8 },
                { month: "4月", value: 10.5 },
                { month: "5月", value: 11.2 },
                { month: "6月", value: 14.8, event: "618" }
            ];
            
            const pie = d3.pie()
                .value(d => d.value)
                .sort(null);
            
            const arc = d3.arc()
                .innerRadius(radius * 0.5)
                .outerRadius(radius);
            
            const arcs = pie(months);
            
            // 绘制扇形
            svg.selectAll("path")
                .data(arcs)
                .enter()
                .append("path")
                .attr("d", arc)
                .attr("fill", (d, i) => d3.interpolate(colors.beige, colors.clay)(i/5))
                .attr("stroke", "white")
                .attr("stroke-width", 2)
                .attr("transform", `translate(${centerX}, ${centerY})`);
            
            // 添加标签
            const labelArc = d3.arc()
                .innerRadius(radius * 0.7)
                .outerRadius(radius * 0.7);
            
            svg.selectAll("text")
                .data(arcs)
                .enter()
                .append("text")
                .attr("transform", d => `translate(${labelArc.centroid(d).map((v, i) => v + [centerX, centerY][i])})`)
                .attr("text-anchor", "middle")
                .text(d => d.data.month)
                .attr("fill", colors.dark)
                .attr("font-size", "12px");
            
            // 添加事件标记
            const eventArcs = arcs.filter(d => d.data.event);
            
            svg.selectAll(".event")
                .data(eventArcs)
                .enter()
                .append("text")
                .attr("transform", d => {
                    const pos = labelArc.centroid(d);
                    pos[0] = pos[0] * 1.5 + centerX;
                    pos[1] = pos[1] * 1.5 + centerY;
                    return `translate(${pos})`;
                })
                .attr("text-anchor", "middle")
                .text(d => d.data.event)
                .attr("fill", colors.blue)
                .attr("font-size", "10px")
                .attr("font-weight", "bold");
            
            // 添加标题
            svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY - radius * 0.3)
                .attr("text-anchor", "middle")
                .text("2024上半年文化用品零售")
                .attr("fill", colors.dark)
                .attr("font-size", "14px");
            
            svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY)
                .attr("text-anchor", "middle")
                .text("占社零总额24.9%")
                .attr("fill", colors.dark)
                .attr("font-size", "12px");
            
            svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY + 20)
                .attr("text-anchor", "middle")
                .text(`增速: ${cultureData.culturalConsumption.growth}%`)
                .attr("fill", colors.clay)
                .attr("font-size", "12px")
                .attr("font-weight", "bold");
        }
        
        // 8. 文化经济贡献联动图
        function createGDPContribution() {
            const container = d3.select("#gdp-contribution");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const margin = { top: 30, right: 30, bottom: 60, left: 60 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
            // 模拟近五年数据
            const years = [2020, 2021, 2022, 2023, 2024];
            const cultureGrowth = [3.2, 8.5, 6.8, 7.5, 7.1];
            const tertiaryGrowth = [2.3, 7.2, 5.5, 6.1, 6.3];
            const cultureShare = [3.6, 3.8, 4.0, 4.1, 4.2];
            
            // 创建比例尺
            const xScale = d3.scaleBand()
                .domain(years)
                .range([0, innerWidth])
                .padding(0.2);
            
            const yScale = d3.scaleLinear()
                .domain([0, 10])
                .range([innerHeight, 0]);
            
            const yScaleRight = d3.scaleLinear()
                .domain([0, 5])
                .range([innerHeight, 0]);
            
            // 添加文化产业增速柱状图
            g.selectAll(".culture-bar")
                .data(years)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d))
                .attr("y", d => yScale(cultureGrowth[years.indexOf(d)]))
                .attr("width", xScale.bandwidth() * 0.4)
                .attr("height", d => innerHeight - yScale(cultureGrowth[years.indexOf(d)]))
                .attr("fill", colors.green)
                .attr("rx", 3)
                .attr("ry", 3);
            
            // 添加第三产业增速柱状图
            g.selectAll(".tertiary-bar")
                .data(years)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d) + xScale.bandwidth() * 0.45)
                .attr("y", d => yScale(tertiaryGrowth[years.indexOf(d)]))
                .attr("width", xScale.bandwidth() * 0.4)
                .attr("height", d => innerHeight - yScale(tertiaryGrowth[years.indexOf(d)]))
                .attr("fill", colors.blue)
                .attr("rx", 3)
                .attr("ry", 3);
            
            // 添加占比折线图
            const line = d3.line()
                .x(d => xScale(d) + xScale.bandwidth() / 2)
                .y(d => yScaleRight(cultureShare[years.indexOf(d)]))
                .curve(d3.curveMonotoneX);
            
            g.append("path")
                .datum(years)
                .attr("d", line)
                .attr("fill", "none")
                .attr("stroke", colors.pink)
                .attr("stroke-width", 3);
            
            // 添加折线图数据点
            g.selectAll(".share-point")
                .data(years)
                .enter()
                .append("circle")
                .attr("cx", d => xScale(d) + xScale.bandwidth() / 2)
                .attr("cy", d => yScaleRight(cultureShare[years.indexOf(d)]))
                .attr("r", 5)
                .attr("fill", colors.pink)
                .attr("stroke", "white")
                .attr("stroke-width", 2);
            
            // 添加占比标签
            g.selectAll(".share-label")
                .data(years)
                .enter()
                .append("text")
                .attr("x", d => xScale(d) + xScale.bandwidth() / 2)
                .attr("y", d => yScaleRight(cultureShare[years.indexOf(d)]) - 10)
                .attr("text-anchor", "middle")
                .text(d => `${cultureShare[years.indexOf(d)]}%`)
                .attr("fill", colors.dark)
                .attr("font-size", "10px");
            
            // 添加X轴
            g.append("g")
                .attr("transform", `translate(0, ${innerHeight})`)
                .call(d3.axisBottom(xScale).tickFormat(d3.format("d")))
                .append("text")
                .attr("x", innerWidth / 2)
                .attr("y", 35)
                .attr("text-anchor", "middle")
                .text("年份")
                .attr("fill", colors.dark);
            
            // 添加左侧Y轴
            g.append("g")
                .call(d3.axisLeft(yScale))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -40)
                .attr("x", -innerHeight/2)
                .attr("text-anchor", "middle")
                .text("增速 (%)")
                .attr("fill", colors.dark);
            
            // 添加右侧Y轴
            g.append("g")
                .attr("transform", `translate(${innerWidth}, 0)`)
                .call(d3.axisRight(yScaleRight))
                .append("text")
                .attr("transform", "rotate(90)")
                .attr("y", 45)
                .attr("x", innerHeight/2)
                .attr("text-anchor", "middle")
                .text("占GDP比重 (%)")
                .attr("fill", colors.pink);
            
            // 添加标题
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .text("文化产业经济贡献分析 (2020-2024)")
                .attr("fill", colors.dark)
                .attr("font-size", "14px");
            
            // 添加图例
            const legend = g.append("g")
                .attr("transform", `translate(${innerWidth - 200}, ${-20})`);
            
            legend.append("rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", 15)
                .attr("height", 15)
                .attr("fill", colors.green);
            
            legend.append("text")
                .attr("x", 20)
                .attr("y", 12)
                .text("文化产业增速")
                .attr("fill", colors.dark)
                .attr("font-size", "12px");
            
            legend.append("rect")
                .attr("x", 120)
                .attr("y", 0)
                .attr("width", 15)
                .attr("height", 15)
                .attr("fill", colors.blue);
            
            legend.append("text")
                .attr("x", 140)
                .attr("y", 12)
                .text("第三产业增速")
                .attr("fill", colors.dark)
                .attr("font-size", "12px");
            
            g.append("path")
                .attr("d", "M" + (innerWidth - 205) + ",-5 L" + (innerWidth - 195) + ",-5")
                .attr("stroke", colors.pink)
                .attr("stroke-width", 2);
            
            g.append("text")
                .attr("x", innerWidth - 190)
                .attr("y", 0)
                .text("占GDP比重")
                .attr("fill", colors.dark)
                .attr("font-size", "12px");
        }
        
        // 添加装饰元素
        function addDecorations() {
            const dashboard = d3.select(".dashboard");
            
            // 添加装饰圆形
            for (let i = 0; i < 15; i++) {
                dashboard.append("div")
                    .attr("class", "decoration circle")
                    .style("width", Math.random() * 80 + 20 + "px")
                    .style("height", Math.random() * 80 + 20 + "px")
                    .style("left", Math.random() * 100 + "%")
                    .style("top", Math.random() * 100 + "%")
                    .style("animation-delay", Math.random() * 5 + "s");
            }
        }
        
        // 初始化所有可视化
        function initVisualizations() {
            createRevenueTrend();
            createIndustryStructure();
            createRegionalMatrix();
            createNewIndustryFlow();
            createProfitHeatmap();
            createEfficiencyBubble();
            createRetailClock();
            createGDPContribution();
            addDecorations();
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', initVisualizations);
        window.addEventListener('resize', initVisualizations);
    </script>
</body>
</html>
