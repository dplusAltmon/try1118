<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>文化产业数据多维饼图可视化</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* 基础布局与留白 */
        body { 
            font-family: "Microsoft YaHei", "SimHei", sans-serif; 
            margin: 0; 
            padding: 40px; 
            background: #f9f9f9; 
        }
        .container { 
            width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 60px 40px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
        }
        
        /* 标题样式（大且简洁） */
        .main-title { 
            font-size: 36px; 
            font-weight: bold; 
            text-align: center; 
            margin: 0 0 60px 0; 
            color: #2c3e50; 
            letter-spacing: 1px; 
        }
        
        /* 图表容器布局（黄金分割位置） */
        .charts-wrapper { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 80px; 
        }
        .arc-chart { 
            width: 50%; 
            /* 横向黄金分割位置：左侧容器宽度50%，内部弧中心再右移10% */
            position: relative; 
            left: 10%; 
        }
        .pie-charts { 
            width: 50%; 
        }
        
        /* 色彩与弧样式 */
        .arc-path { 
            stroke: white; 
            stroke-width: 2; 
            transition: all 0.3s; 
        }
        .arc-path:hover { 
            opacity: 0.8; 
            transform: scale(1.02); 
        }
        .text-label { 
            font-size: 14px; 
            text-anchor: middle; 
            dominant-baseline: middle; 
        }
        .data-label { 
            font-size: 12px; 
            font-weight: bold; 
        }
        
        /* 签名档样式（高频区域，多行中英文） */
        .signature { 
            margin-top: 60px; 
            text-align: right; 
            padding-right: 40px; 
        }
        .signature-cn { 
            font-style: italic; 
            font-size: 16px; 
            color: #34495e; 
            margin: 0; 
        }
        .signature-en { 
            font-size: 12px; 
            color: #7f8c8d; 
            margin: 5px 0 0 0; 
        }
        
        /* 子标题样式 */
        .sub-title { 
            font-size: 18px; 
            color: #34495e; 
            margin: 0 0 20px 0; 
            border-left: 4px solid #3498db; 
            padding-left: 10px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 大标题（简洁） -->
        <h1 class="main-title">文化产业数据分布</h1>
        
        <div class="charts-wrapper">
            <!-- 左侧：弧与首位相连饼图 -->
            <div class="arc-chart">
                <h3 class="sub-title">行业增长率分布弧</h3>
                <div id="arc-container"></div>
                
                <h3 class="sub-title" style="margin-top: 60px;">增长率角度饼图</h3>
                <div id="angle-pie-container"></div>
            </div>
            
            <!-- 右侧：原生数据饼图 -->
            <div class="pie-charts">
                <h3 class="sub-title">营业收入占比</h3>
                <div id="data-pie-container"></div>
                
                <!-- 创意添加：增长率与收入对比小图 -->
                <h3 class="sub-title" style="margin-top: 40px;">增长率热力标注</h3>
                <div id="growth-heatmap" style="height: 150px;"></div>
            </div>
        </div>
        
        <!-- 签名档 -->
        <div class="signature">
            <p class="signature-cn">22计传 张颖惠</p>
            <p class="signature-en">Visualization by Zhang Yinghui, 2025</p>
        </div>
    </div>

    <script>
        // 1. 多维度数据提取（营业收入、增长率、占比）
        const industryData = [
            { name: "新闻信息", revenue: 22276, growth: 8.6 },
            { name: "内容创作", revenue: 38827, growth: 8.4 },
            { name: "创意设计", revenue: 38890, growth: 7.2 },
            { name: "传播渠道", revenue: 19898, growth: 4.5 },
            { name: "娱乐休闲", revenue: 4292, growth: 1.2 },
            { name: "文化装备", revenue: 7820, growth: 11.2 }
        ];
        
        // 计算占比（新增维度）
        const totalRevenue = industryData.reduce((sum, d) => sum + d.revenue, 0);
        industryData.forEach(d => {
            d.percentage = ((d.revenue / totalRevenue) * 100).toFixed(1);
        });

        // 2. 绘制弧（d3.arc()，黄金分割位置）
        function drawArc() {
            const width = 300;
            const height = 300;
            const radius = 100;
            
            const svg = d3.select("#arc-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // 定义弧生成器（起始角度0，终止角度按增长率比例分配，最大180度）
            const arc = d3.arc()
                .innerRadius(radius - 40)
                .outerRadius(radius)
                .startAngle(0);
            
            // 计算每个行业的终止角度（增长率最高11.2，映射到π弧度）
            const maxGrowth = d3.max(industryData, d => d.growth);
            industryData.forEach((d, i) => {
                const endAngle = (d.growth / maxGrowth) * Math.PI; // 最大π弧度（180度）
                
                svg.append("path")
                    .attr("class", "arc-path")
                    .attr("d", arc.endAngle(endAngle))
                    .attr("fill", d3.schemeCategory10[i])
                    .attr("transform", `translate(${width/2}, ${height/2})`); // 平移到容器中心
                
                // 弧中心文本（显示增长率）
                const centroid = arc.centroid({ startAngle: 0, endAngle: endAngle });
                svg.append("text")
                    .attr("class", "text-label")
                    .attr("x", width/2 + centroid[0])
                    .attr("y", height/2 + centroid[1])
                    .text(d.growth + "%")
                    .attr("fill", "#333");
            });
        }

        // 3. 绘制首位相连的饼图（显示度数）
        function drawAnglePie() {
            const width = 300;
            const height = 300;
            const radius = 100;
            
            const svg = d3.select("#angle-pie-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // 计算角度（首位相连，总角度360度）
            const pie = d3.pie()
                .value(d => d.growth)
                .sort(null);
            
            const arcs = pie(industryData);
            const arc = d3.arc()
                .innerRadius(radius - 50)
                .outerRadius(radius);
            
            // 绘制弧
            svg.selectAll(".arc-path")
                .data(arcs)
                .enter()
                .append("path")
                .attr("class", "arc-path")
                .attr("d", arc)
                .attr("fill", (d, i) => d3.schemeCategory10[i])
                .attr("transform", `translate(${width/2}, ${height/2})`);
            
            // 弧中心添加度数文本（弧度转角度）
            arcs.forEach((d, i) => {
                const centroid = arc.centroid(d);
                const angleDeg = ((d.endAngle - d.startAngle) * 180 / Math.PI).toFixed(0);
                
                svg.append("text")
                    .attr("class", "text-label")
                    .attr("x", width/2 + centroid[0])
                    .attr("y", height/2 + centroid[1])
                    .text(angleDeg + "°")
                    .attr("fill", "#333");
            });
        }

        // 4. 用d3.pie和d3.arc绘制原生数据饼图（标注数据/百分比）
        function drawDataPie() {
            const width = 350;
            const height = 350;
            const radius = 150;
            
            const svg = d3.select("#pie-charts")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // 饼图布局（按营业收入分配角度）
            const pie = d3.pie()
                .value(d => d.revenue)
                .sort(null);
            
            const arcs = pie(industryData);
            const arc = d3.arc()
                .innerRadius(50) // 环形图，有内半径
                .outerRadius(radius);
            
            // 绘制弧
            svg.selectAll(".arc-path")
                .data(arcs)
                .enter()
                .append("path")
                .attr("class", "arc-path")
                .attr("d", arc)
                .attr("fill", (d, i) => d3.schemeCategory10[i])
                .attr("transform", `translate(${width/2}, ${height/2})`);
            
            // 标注原生数据和百分比
            arcs.forEach((d, i) => {
                const centroid = arc.centroid(d);
                const data = industryData[i];
                
                // 营业收入（亿元）
                svg.append("text")
                    .attr("class", "text-label data-label")
                    .attr("x", width/2 + centroid[0])
                    .attr("y", height/2 + centroid[1] - 10)
                    .text(data.revenue + "亿")
                    .attr("fill", "white");
                
                // 占比
                svg.append("text")
                    .attr("class", "text-label")
                    .attr("x", width/2 + centroid[0])
                    .attr("y", height/2 + centroid[1] + 10)
                    .text(data.percentage + "%")
                    .attr("fill", "white");
            });
        }

        // 5. 创意添加：增长率热力标注条（小组讨论+DeepSeek辅助）
        function drawGrowthHeatmap() {
            const width = 350;
            const height = 150;
            const margin = { top: 20, right: 20, bottom: 30, left: 60 };
            
            const svg = d3.select("#growth-heatmap")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // X轴：行业名称
            const xScale = d3.scaleBand()
                .domain(industryData.map(d => d.name))
                .range([margin.left, width - margin.right])
                .padding(0.2);
            
            // Y轴：增长率
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(industryData, d => d.growth)])
                .range([height - margin.bottom, margin.top]);
            
            // 热力矩形（高度映射增长率，颜色深度也映射）
            svg.selectAll("rect")
                .data(industryData)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d.name))
                .attr("y", d => yScale(d.growth))
                .attr("width", xScale.bandwidth())
                .attr("height", d => (height - margin.bottom) - yScale(d.growth))
                .attr("fill", d => {
                    // 颜色随增长率加深
                    const color = d3.interpolateReds(d.growth / 12);
                    return color;
                });
            
            // X轴刻度
            svg.append("g")
                .attr("transform", `translate(0, ${height - margin.bottom})`)
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .attr("transform", "rotate(-30)")
                .style("text-anchor", "end");
        }

        // 初始化所有图表
        drawArc();
        drawAnglePie();
        drawDataPie();
        drawGrowthHeatmap();
    </script>
</body>
</html>
