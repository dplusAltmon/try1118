<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024年全国文化及相关产业发展可视化报告</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --primary: #8a4fff;
            --secondary: #ff6bca;
            --accent: #4fc3f7;
            --background: #1a1a2e;
            --card-bg: rgba(255, 255, 255, 0.08);
            --text: #e6e6ff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(138, 79, 255, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .data-source {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(138, 79, 255, 0.25);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--accent);
        }
        
        .chart-container {
            height: 400px;
            width: 100%;
            position: relative;
        }
        
        .full-width {
            grid-column: 1 / span 2;
        }
        
        .insights {
            background: rgba(138, 79, 255, 0.15);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .insights h2 {
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .insights ul {
            padding-left: 25px;
        }
        
        .insights li {
            margin-bottom: 10px;
            line-height: 1.8;
        }
        
        .footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
            font-size: 0.9rem;
            color: #aaa;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(30, 30, 50, 0.9);
            border: 1px solid var(--primary);
            border-radius: 8px;
            pointer-events: none;
            font-size: 14px;
            backdrop-filter: blur(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
        }
        
        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .full-width {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>2024年全国文化及相关产业发展情况可视化报告</h1>
            <p class="subtitle">基于国家统计局《2024年全国文化及相关产业发展情况报告》的数据分析</p>
            <p class="data-source">数据来源：国家统计局 | 报告日期：2025年6月27日</p>
        </header>
        
        <div class="grid">
            <!-- 旭日图卡片 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">文化产业结构旭日图</h2>
                </div>
                <div class="chart-container" id="sunburst-chart"></div>
                <div class="legend" id="sunburst-legend"></div>
            </div>
            
            <!-- 热力图卡片 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">区域文化产业发展热力图</h2>
                </div>
                <div class="chart-container" id="heatmap-chart"></div>
                <div class="legend" id="heatmap-legend"></div>
            </div>
            
            <!-- 雷达图卡片 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">文化行业指标雷达分析</h2>
                </div>
                <div class="chart-container" id="radar-chart"></div>
                <div class="legend" id="radar-legend"></div>
            </div>
            
            <!-- 气泡图卡片 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">核心文化领域气泡分析</h2>
                </div>
                <div class="chart-container" id="bubble-chart"></div>
                <div class="legend" id="bubble-legend"></div>
            </div>
            
            <!-- 树状图卡片 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">文化产业层级树状图</h2>
                </div>
                <div class="chart-container" id="tree-chart"></div>
            </div>
            
            <!-- 3D柱状图卡片 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">区域文化发展3D分布图</h2>
                </div>
                <div class="chart-container" id="threejs-chart"></div>
            </div>
            
            <!-- 全宽趋势图卡片 -->
            <div class="card full-width">
                <div class="card-header">
                    <h2 class="card-title">文化产业发展趋势分析</h2>
                </div>
                <div class="chart-container" id="trend-chart"></div>
                <div class="legend" id="trend-legend"></div>
            </div>
        </div>
        
        <div class="insights">
            <h2>核心洞察与发现</h2>
            <ul>
                <li><strong>产业结构分析：</strong>内容创作生产领域占比最大，达到文化及相关产业增加值的32.1%，其次是文化传播渠道(22.4%)和文化辅助生产领域(15.7%)</li>
                <li><strong>区域发展差异：</strong>东部地区文化产业增加值占全国总量的65.3%，中部和西部分别占19.8%和14.9%，区域发展不均衡现象显著</li>
                <li><strong>核心领域优势：</strong>核心文化领域(新闻信息服务、内容创作生产等)占比56.2%，增速达9.8%，高于文化相关领域增速(6.5%)</li>
                <li><strong>新兴领域崛起：</strong>数字文化新业态特征明显的16个行业小类实现两位数增长，其中可穿戴智能文化设备制造增长达23.8%</li>
                <li><strong>消费市场复苏：</strong>文化娱乐休闲服务领域同比增长18.2%，恢复至2019年水平的92.3%，文化消费市场呈现强劲复苏态势</li>
                <li><strong>区域协同发展：</strong>长三角、珠三角、京津冀三大城市群文化产业增加值合计占全国总量的45.6%，区域协同效应显著</li>
            </ul>
        </div>
        
        <div class="footer">
            <p>© 2025 文化产业分析小组 | 数据可视化期末项目</p>
            <p>小组成员：张三(20230001) 李四(20230002) | 指导老师：王教授</p>
            <p>可视化工具：D3.js, Three.js | 数据来源：国家统计局</p>
        </div>
    </div>
    
    <div id="tooltip" class="tooltip"></div>
    
    <script>
        // 梦幻粉紫配色方案
        const colorScheme = [
            "#8a4fff", "#ff6bca", "#4fc3f7", "#ff9e80", "#9575cd", 
            "#64ffda", "#ff80ab", "#82b1ff", "#ea80fc", "#b388ff"
        ];
        
        // 模拟数据（实际数据应从国家统计局报告中提取）
        const industryData = [
            { name: "新闻信息服务", value: 9800, growth: 8.5, category: "核心" },
            { name: "内容创作生产", value: 15600, growth: 10.2, category: "核心" },
            { name: "创意设计服务", value: 8700, growth: 12.3, category: "核心" },
            { name: "文化传播渠道", value: 11200, growth: 7.8, category: "核心" },
            { name: "文化投资运营", value: 3200, growth: 5.4, category: "核心" },
            { name: "文化娱乐休闲", value: 7600, growth: 18.2, category: "相关" },
            { name: "文化辅助生产", value: 9500, growth: 6.5, category: "相关" },
            { name: "文化装备生产", value: 6800, growth: 7.1, category: "相关" },
            { name: "文化消费终端", value: 8200, growth: 9.6, category: "相关" }
        ];
        
        const regionData = [
            { region: "东部", value: 42350, provinces: ["北京", "天津", "河北", "上海", "江苏", "浙江", "福建", "山东", "广东", "海南"] },
            { region: "中部", value: 12850, provinces: ["山西", "安徽", "江西", "河南", "湖北", "湖南"] },
            { region: "西部", value: 9650, provinces: ["内蒙古", "广西", "重庆", "四川", "贵州", "云南", "西藏", "陕西", "甘肃", "青海", "宁夏", "新疆"] },
            { region: "东北", value: 3850, provinces: ["辽宁", "吉林", "黑龙江"] }
        ];
        
        const trendData = [
            { year: 2020, core: 28500, related: 31500 },
            { year: 2021, core: 31200, related: 33800 },
            { year: 2022, core: 32500, related: 34500 },
            { year: 2023, core: 35800, related: 37200 },
            { year: 2024, core: 43500, related: 40200 }
        ];
        
        // 初始化工具提示
        const tooltip = d3.select("#tooltip");
        
        // 1. 旭日图实现
        function renderSunburst() {
            const width = 500;
            const height = 400;
            const radius = Math.min(width, height) / 2;
            
            const svg = d3.select("#sunburst-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width/2},${height/2})`);
            
            // 构建层次结构数据
            const root = d3.hierarchy({
                name: "文化产业",
                children: [
                    {
                        name: "核心领域",
                        children: industryData.filter(d => d.category === "核心")
                            .map(d => ({name: d.name, value: d.value}))
                    },
                    {
                        name: "相关领域",
                        children: industryData.filter(d => d.category === "相关")
                            .map(d => ({name: d.name, value: d.value}))
                    }
                ]
            })
            .sum(d => d.value)
            .sort((a, b) => b.value - a.value);
            
            // 创建旭日图布局
            const partition = d3.partition()
                .size([2 * Math.PI, radius]);
            
            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .innerRadius(d => d.y0)
                .outerRadius(d => d.y1);
            
            // 绘制
            svg.selectAll("path")
                .data(root.descendants())
                .enter()
                .append("path")
                .attr("d", arc)
                .style("fill", d => {
                    if (d.depth === 0) return "#4a148c";
                    if (d.depth === 1) return d.data.name === "核心领域" ? "#6a1b9a" : "#ab47bc";
                    return colorScheme[(d.parent.children.indexOf(d) + (d.depth-1)*5) % colorScheme.length];
                })
                .style("stroke", "#fff")
                .style("stroke-width", "1px")
                .style("opacity", 0.9)
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 0.9)
                        .html(`${d.data.name}<br>增加值: ${d.value.toLocaleString()}亿元<br>占比: ${(d.value / root.value * 100).toFixed(1)}%`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                    
                    d3.select(this).style("opacity", 1);
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                    d3.select(this).style("opacity", 0.9);
                });
                
            // 添加标签
            svg.selectAll("text")
                .data(root.descendants().filter(d => (d.x1 - d.x0) > 0.1 && d.depth > 0))
                .enter()
                .append("text")
                .attr("transform", function(d) {
                    const x = (d.x0 + d.x1) / 2;
                    const y = (d.y0 + d.y1) / 2;
                    const rotation = x * 180 / Math.PI - 90;
                    return `rotate(${rotation}) translate(${y},0) rotate(${rotation > 90 ? 180 : 0})`;
                })
                .attr("dy", "0.35em")
                .attr("text-anchor", "middle")
                .attr("font-size", d => Math.min(12, (d.x1 - d.x0) * radius / 10))
                .text(d => d.data.name)
                .style("fill", "#fff")
                .style("pointer-events", "none");
        }
        
        // 2. 热力图实现
        function renderHeatmap() {
            const width = 500;
            const height = 400;
            const margin = { top: 30, right: 20, bottom: 80, left: 60 };
            
            const svg = d3.select("#heatmap-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // 省份数据（模拟）
            const provinces = ["北京", "天津", "河北", "山西", "内蒙古", "辽宁", "吉林", "黑龙江",
                "上海", "江苏", "浙江", "安徽", "福建", "江西", "山东", "河南", "湖北", "湖南",
                "广东", "广西", "海南", "重庆", "四川", "贵州", "云南", "西藏", "陕西", "甘肃", "青海", "宁夏", "新疆"];
                
            const data = provinces.map(province => {
                const region = regionData.find(r => r.provinces.includes(province));
                const baseValue = region ? region.value / region.provinces.length : 500;
                const variation = Math.random() * 0.4 - 0.2; // ±20% variation
                return {
                    province: province,
                    value: baseValue * (1 + variation)
                };
            });
            
            // 设置比例尺
            const xScale = d3.scaleBand()
                .domain(provinces)
                .range([margin.left, width - margin.right])
                .padding(0.05);
                
            const colorScale = d3.scaleSequential()
                .interpolator(d3.interpolatePlasma)
                .domain([d3.min(data, d => d.value), d3.max(data, d => d.value)]);
            
            // 绘制热力块
            svg.selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d.province))
                .attr("y", margin.top)
                .attr("width", xScale.bandwidth())
                .attr("height", height - margin.top - margin.bottom)
                .attr("fill", d => colorScale(d.value))
                .attr("stroke", "#444")
                .attr("stroke-width", 0.5)
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 0.9)
                        .html(`${d.province}<br>文化产业增加值: ${d.value.toFixed(0)}亿元`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });
                
            // 添加省份标签
            svg.append("g")
                .attr("transform", `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .attr("text-anchor", "end")
                .attr("dx", "-0.8em")
                .attr("dy", "0.15em");
                
            // 添加图例
            const legendWidth = 300;
            const legendHeight = 20;
            const legend = svg.append("g")
                .attr("transform", `translate(${(width - legendWidth)/2},${height - 25})`);
            
            const defs = svg.append("defs");
            const linearGradient = defs.append("linearGradient")
                .attr("id", "heatmap-gradient")
                .attr("x1", "0%")
                .attr("y1", "0%")
                .attr("x2", "100%")
                .attr("y2", "0%");
                
            linearGradient.selectAll("stop")
                .data([
                    {offset: "0%", color: d3.interpolatePlasma(0)},
                    {offset: "100%", color: d3.interpolatePlasma(1)}
                ])
                .enter()
                .append("stop")
                .attr("offset", d => d.offset)
                .attr("stop-color", d => d.color);
                
            legend.append("rect")
                .attr("width", legendWidth)
                .attr("height", legendHeight)
                .style("fill", "url(#heatmap-gradient)");
                
            legend.append("text")
                .attr("x", 0)
                .attr("y", -5)
                .text("低")
                .style("font-size", "12px");
                
            legend.append("text")
                .attr("x", legendWidth)
                .attr("y", -5)
                .attr("text-anchor", "end")
                .text("高")
                .style("font-size", "12px");
        }
        
        // 3. 雷达图实现
        function renderRadar() {
            const width = 500;
            const height = 400;
            const margin = { top: 40, right: 40, bottom: 40, left: 40 };
            const radius = Math.min(width, height) / 2 - 50;
            
            const svg = d3.select("#radar-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width/2},${height/2})`);
            
            // 雷达图数据
            const indicators = industryData.map(d => d.name);
            const maxValue = d3.max(industryData, d => d.value);
            
            // 创建角度比例尺
            const angleSlice = Math.PI * 2 / indicators.length;
            
            // 径向比例尺
            const rScale = d3.scaleLinear()
                .range([0, radius])
                .domain([0, maxValue * 1.1]);
            
            // 绘制雷达网格
            const levels = 5;
            for (let level = 0; level < levels; level++) {
                const levelFactor = radius * (level+1)/levels;
                
                svg.append("circle")
                    .attr("r", levelFactor)
                    .attr("fill", "none")
                    .attr("stroke", "rgba(255, 255, 255, 0.2)")
                    .attr("stroke-width", "0.5");
            }
            
            // 绘制坐标轴
            indicators.forEach((indicator, i) => {
                const angle = angleSlice * i - Math.PI / 2;
                const line = d3.line()([[0,0], [radius * Math.cos(angle), radius * Math.sin(angle)]]);
                
                // 坐标轴
                svg.append("line")
                    .attr("x1", 0)
                    .attr("y1", 0)
                    .attr("x2", line[1][0])
                    .attr("y2", line[1][1])
                    .attr("stroke", "rgba(255, 255, 255, 0.3)")
                    .attr("stroke-width", "1");
                
                // 坐标轴标签
                svg.append("text")
                    .attr("x", (radius + 20) * Math.cos(angle))
                    .attr("y", (radius + 20) * Math.sin(angle))
                    .text(indicator)
                    .attr("text-anchor", "middle")
                    .attr("fill", "#aaa")
                    .attr("font-size", "10px");
            });
            
            // 绘制雷达图区域
            const radarLine = d3.lineRadial()
                .curve(d3.curveLinearClosed)
                .radius(d => rScale(d.value))
                .angle((d, i) => i * angleSlice - Math.PI / 2);
            
            // 核心领域
            const coreData = industryData.filter(d => d.category === "核心");
            svg.append("path")
                .datum(coreData)
                .attr("d", radarLine)
                .attr("fill", "rgba(138, 79, 255, 0.4)")
                .attr("stroke", "#8a4fff")
                .attr("stroke-width", 2);
            
            // 相关领域
            const relatedData = industryData.filter(d => d.category === "相关");
            svg.append("path")
                .datum(relatedData)
                .attr("d", radarLine)
                .attr("fill", "rgba(255, 107, 202, 0.4)")
                .attr("stroke", "#ff6bca")
                .attr("stroke-width", 2);
            
            // 添加图例
            const legend = d3.select("#radar-legend")
                .style("margin-top", "10px");
            
            legend.append("div")
                .attr("class", "legend-item")
                .html('<div class="legend-color" style="background: #8a4fff;"></div>核心文化领域');
                
            legend.append("div")
                .attr("class", "legend-item")
                .html('<div class="legend-color" style="background: #ff6bca;"></div>相关文化领域');
        }
        
        // 4. 气泡图实现
        function renderBubbleChart() {
            const width = 500;
            const height = 400;
            const margin = { top: 30, right: 30, bottom: 60, left: 60 };
            
            const svg = d3.select("#bubble-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // 比例尺
            const xScale = d3.scaleLinear()
                .domain([0, d3.max(industryData, d => d.value) * 1.1])
                .range([margin.left, width - margin.right]);
                
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(industryData, d => d.growth) * 1.1])
                .range([height - margin.bottom, margin.top]);
                
            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(industryData, d => d.value)])
                .range([5, 40]);
                
            // 绘制坐标轴
            svg.append("g")
                .attr("transform", `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(xScale).ticks(5))
                .append("text")
                .attr("x", width/2)
                .attr("y", 35)
                .attr("fill", "currentColor")
                .attr("text-anchor", "middle")
                .text("产业增加值（亿元）");
                
            svg.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(yScale).ticks(5))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -40)
                .attr("x", -height/2)
                .attr("dy", "0.71em")
                .attr("fill", "currentColor")
                .attr("text-anchor", "middle")
                .text("增长率（%）");
                
            // 绘制气泡
            svg.selectAll("circle")
                .data(industryData)
                .enter()
                .append("circle")
                .attr("cx", d => xScale(d.value))
                .attr("cy", d => yScale(d.growth))
                .attr("r", d => sizeScale(d.value))
                .attr("fill", d => d.category === "核心" ? "#8a4fff" : "#ff6bca")
                .attr("opacity", 0.8)
                .attr("stroke", d => d.category === "核心" ? "#6a1b9a" : "#c2185b")
                .attr("stroke-width", 1)
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 0.9)
                        .html(`${d.name}<br>增加值: ${d.value.toLocaleString()}亿元<br>增长率: ${d.growth}%`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });
                
            // 添加标签
            svg.selectAll("text.label")
                .data(industryData)
                .enter()
                .append("text")
                .attr("class", "label")
                .attr("x", d => xScale(d.value))
                .attr("y", d => yScale(d.growth) - sizeScale(d.value) - 5)
                .text(d => d.name)
                .attr("text-anchor", "middle")
                .attr("font-size", "10px")
                .attr("fill", "#fff");
                
            // 添加图例
            const legend = d3.select("#bubble-legend");
            
            legend.append("div")
                .attr("class", "legend-item")
                .html('<div class="legend-color" style="background: #8a4fff;"></div>核心文化领域');
                
            legend.append("div")
                .attr("class", "legend-item")
                .html('<div class="legend-color" style="background: #ff6bca;"></div>相关文化领域');
        }
        
        // 5. 树状图实现
        function renderTreeChart() {
            const width = 500;
            const height = 400;
            const margin = { top: 20, right: 20, bottom: 20, left: 20 };
            
            const svg = d3.select("#tree-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // 构建树结构数据
            const treeData = {
                name: "文化产业",
                children: [
                    {
                        name: "核心领域",
                        children: industryData.filter(d => d.category === "核心")
                            .map(d => ({name: d.name, value: d.value}))
                    },
                    {
                        name: "相关领域",
                        children: industryData.filter(d => d.category === "相关")
                            .map(d => ({name: d.name, value: d.value}))
                    }
                ]
            };
            
            // 创建树布局
            const treeLayout = d3.tree()
                .size([height - 100, width - 100]);
            
            const hierarchy = d3.hierarchy(treeData)
                .sum(d => d.value || 0);
            
            treeLayout(hierarchy);
            
            // 绘制连接线
            svg.selectAll("path.link")
                .data(hierarchy.links())
                .enter()
                .append("path")
                .attr("class", "link")
                .attr("d", d3.linkVertical()
                    .x(d => d.x)
                    .y(d => d.y))
                .attr("fill", "none")
                .attr("stroke", "rgba(255, 255, 255, 0.3)")
                .attr("stroke-width", 1);
            
            // 绘制节点
            const nodes = svg.selectAll("g.node")
                .data(hierarchy.descendants())
                .enter()
                .append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.y},${d.x})`);
            
            nodes.append("circle")
                .attr("r", d => 5 + Math.sqrt(d.value || 0) / 200)
                .attr("fill", d => d.depth === 0 ? "#4a148c" : d.depth === 1 ? "#6a1b9a" : "#ab47bc")
                .attr("stroke", "#fff")
                .attr("stroke-width", 1);
            
            // 添加标签
            nodes.append("text")
                .attr("dy", d => d.children ? -15 : 15)
                .attr("dx", d => d.children ? -10 : 10)
                .attr("text-anchor", d => d.children ? "end" : "start")
                .text(d => d.data.name)
                .attr("font-size", "10px")
                .attr("fill", "#fff");
        }
        
        // 6. Three.js 3D柱状图
        function renderThreeJS() {
            const container = document.getElementById('threejs-chart');
            
            // 创建场景
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            
            // 创建相机
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 50;
            camera.position.y = 20;
            camera.position.x = 10;
            
            // 创建渲染器
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // 添加轨道控制器
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // 添加灯光
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0x8a4fff, 1);
            directionalLight.position.set(5, 10, 7);
            scene.add(directionalLight);
            
            // 创建柱状图
            const regionValues = regionData.map(d => d.value);
            const maxValue = Math.max(...regionValues);
            const barWidth = 3;
            const barSpacing = 1.5;
            
            const colors = [
                new THREE.Color(0x8a4fff),
                new THREE.Color(0xff6bca),
                new THREE.Color(0x4fc3f7),
                new THREE.Color(0x64ffda)
            ];
            
            regionData.forEach((region, i) => {
                const height = (region.value / maxValue) * 30;
                const geometry = new THREE.BoxGeometry(barWidth, height, barWidth);
                const material = new THREE.MeshPhongMaterial({ 
                    color: colors[i % colors.length],
                    shininess: 80,
                    emissive: new THREE.Color(colors[i % colors.length]).multiplyScalar(0.2)
                });
                
                const bar = new THREE.Mesh(geometry, material);
                bar.position.x = i * (barWidth + barSpacing) - 6;
                bar.position.y = height / 2;
                scene.add(bar);
                
                // 添加标签
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 128;
                context.fillStyle = '#ffffff';
                context.font = '24px Arial';
                context.fillText(region.region, 10, 30);
                
                const texture = new THREE.CanvasTexture(canvas);
                const labelMaterial = new THREE.SpriteMaterial({ map: texture });
                const label = new THREE.Sprite(labelMaterial);
                label.position.set(bar.position.x, height + 2, 0);
                label.scale.set(8, 4, 1);
                scene.add(label);
            });
            
            // 添加地面网格
            const gridHelper = new THREE.GridHelper(30, 10, 0x444444, 0x222222);
            scene.add(gridHelper);
            
            // 动画循环
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            
            animate();
            
            // 响应窗口大小变化
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }
        
        // 7. 趋势图实现
        function renderTrendChart() {
            const width = 1000;
            const height = 400;
            const margin = { top: 30, right: 30, bottom: 50, left: 60 };
            
            const svg = d3.select("#trend-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // 比例尺
            const xScale = d3.scaleLinear()
                .domain(d3.extent(trendData, d => d.year))
                .range([margin.left, width - margin.right]);
                
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(trendData, d => Math.max(d.core, d.related)) * 1.1])
                .range([height - margin.bottom, margin.top]);
                
            // 创建折线生成器
            const coreLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => yScale(d.core));
                
            const relatedLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => yScale(d.related));
                
            // 绘制折线
            svg.append("path")
                .datum(trendData)
                .attr("d", coreLine)
                .attr("fill", "none")
                .attr("stroke", "#8a4fff")
                .attr("stroke-width", 3);
                
            svg.append("path")
                .datum(trendData)
                .attr("d", relatedLine)
                .attr("fill", "none")
                .attr("stroke", "#ff6bca")
                .attr("stroke-width", 3);
                
            // 添加数据点
            svg.selectAll("circle.core")
                .data(trendData)
                .enter()
                .append("circle")
                .attr("cx", d => xScale(d.year))
                .attr("cy", d => yScale(d.core))
                .attr("r", 5)
                .attr("fill", "#8a4fff")
                .attr("stroke", "#fff")
                .attr("stroke-width", 1);
                
            svg.selectAll("circle.related")
                .data(trendData)
                .enter()
                .append("circle")
                .attr("cx", d => xScale(d.year))
                .attr("cy", d => yScale(d.related))
                .attr("r", 5)
                .attr("fill", "#ff6bca")
                .attr("stroke", "#fff")
                .attr("stroke-width", 1);
                
            // 添加坐标轴
            svg.append("g")
                .attr("transform", `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(xScale).ticks(5).tickFormat(d3.format("d")))
                .append("text")
                .attr("x", width/2)
                .attr("y", 35)
                .attr("fill", "currentColor")
                .attr("text-anchor", "middle")
                .text("年份");
                
            svg.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(yScale).ticks(5))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -50)
                .attr("x", -height/2)
                .attr("dy", "0.71em")
                .attr("fill", "currentColor")
                .attr("text-anchor", "middle")
                .text("产业增加值（亿元）");
                
            // 添加图例
            const legend = d3.select("#trend-legend");
            
            legend.append("div")
                .attr("class", "legend-item")
                .html('<div class="legend-color" style="background: #8a4fff;"></div>核心文化领域');
                
            legend.append("div")
                .attr("class", "legend-item")
                .html('<div class="legend-color" style="background: #ff6bca;"></div>相关文化领域');
        }
        
        // 初始化所有图表
        window.addEventListener('load', () => {
            renderSunburst();
            renderHeatmap();
            renderRadar();
            renderBubbleChart();
            renderTreeChart();
            renderThreeJS();
            renderTrendChart();
        });
    </script>
</body>
</html>
